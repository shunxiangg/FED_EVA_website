<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details</title>
    <link rel="stylesheet" href="css_folder/cart.css">
    <link rel="stylesheet" href="css_folder/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>

<body>
    <header>
        <nav class="navbar">
            <div class="logo">
                <a href="home.html">
                    EVA
                </a>
            </div>
            <ul class="menu">
                <!-- Add after userDisplay span in navbar -->
                <li><span id="userDisplay"></span></li>
                <li><button id="logoutBtn" onclick="logout()" style="display: none;">Logout</button></li>
                <li><a href="home.html" class="nav-link">Home</a></li>
                <li><a href="browse.html" class="nav-link_active">Browse</a></li>
                <li><a href="sell.html" class="nav-link">Sell</a></li>
                <!-- <li><a class="fas fa-shopping-cart" href="javascript:void(0)" onclick="openCart()" class="nav-link"></a></li> -->
                <li><a class="fas fa-user" href="profile.html" class="nav-link"></a></li>
            </ul>
            <div class="hamburger" onclick="toggleMenu()">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </nav>
    </header>

    <!-- Back Button -->
    <button class="back-button-main" onclick="window.location.href='browse.html'">
        <svg xmlns="http://www.w3.org/2000/svg" height="40" width="40" viewBox="0 0 24 24">
            <path d="M14 7l-5 5 5 5V7z" />
        </svg>
    </button>

    <main class="product-details-container">
        <div id="product-details">Loading...</div>
    </main>
    <button id="messageSellerBtn" class="message-seller-btn">
        <i class="fas fa-comment"></i>
    </button>
    <!-- cart button conner right -->
    <button id="cart-toggle" class="cart-toggle" onclick="window.location.href='cart.html'">
        <i class="fas fa-shopping-cart"></i>
        <span id="cartCount" class="cart-count">0</span>
    </button>

    <footer>
        <div id="language-selector">
            <select id="language-dropdown" onchange="changeLanguage()">
                <option value="en">English</option>
                <option value="zh">Chinese</option>
                <option value="ms">Malay</option>
                <option value="hi">Hindi</option>
            </select>
        </div>

        <div class="footer-content">
            <p>&copy; 2025 MokeSell. All rights reserved.</p>
            <div class="footer-links">
                <a href="/about">About Us</a> |
                <a href="/privacy-policy">Privacy Policy</a> |
                <a href="/terms-of-service">Terms of Service</a>
            </div>
            <div class="social-media">
                <a class="fab fa-instagram" href="https://www.instagram.com/" target="_blank"> Instagram</a> |
                <a class="fab fa-facebook" href="https://facebook.com" target="_blank"> Facebook</a> |
                <a class="fab fa-twitter" href="https://twitter.com" target="_blank"> Twitter</a> |
                <a class="fab fa-linkedin" href="https://linkedin.com" target="_blank"> LinkedIn</a>
            </div>
        </div>
    </footer>

    <script src="js_folder/cart.js"></script>
    <script src="js_folder/chat.js"></script>
    <script src="js_folder/productinformation.js"></script>
    <!-- <script>
        const APIKEY = "6787a92c77327a0a035a5437";
        const DATABASE_URL = "https://evadatabase-f3b8.restdb.io/rest/sell";
        let globalProduct; // Global variable to store product details

        async function getProductDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            if (!productId) {
                document.getElementById('product-details').innerHTML = 'Product not found';
                return;
            }
            try {
                const response = await fetch(`${DATABASE_URL}/${productId}`, {
                    headers: {
                        "Content-Type": "application/json",
                        "x-apikey": APIKEY
                    }
                });
                globalProduct = await response.json(); // Store product globally
                displayProductDetails(globalProduct);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('product-details').innerHTML = 'Error loading product';
            }
        }

        function displayProductDetails(product) {
            const detailsHtml = `
            <div class="product-details-grid">
                <div class="product-image-large">
                    ${product.imageData ?
                    `<img src="${product.imageData}" alt="${product.itemName}">` :
                    '<div class="no-image">No Image Available</div>'
                }
                </div>
                <div class="product-info">
                    <h1>${product.itemName}</h1>
                    <p class="price">$${product.price}</p>
                    <p class="description">${product.description}</p>
                    <div class="specs">
                        <p><strong>Category:</strong> ${product.category}</p>
                        <p><strong>Condition:</strong> ${product.condition}</p>
                        <p><strong>Seller:</strong> ${product.sellerName}</p>
                    </div>
                    <button onclick="addToCart('${product._id}')" class="add-to-cart-btn">
                        Add to Cart
                    </button>
                </div>
            </div>
            `;
            document.getElementById('product-details').innerHTML = detailsHtml;
        }

        async function startChatWithSeller() {
            if (!globalProduct) {
                console.error('No product selected');
                return;
            }

            const buyerEmail = localStorage.getItem('userEmail');

            if (!buyerEmail) {
                alert('Please log in to start a chat');
                localStorage.setItem('returnUrl', window.location.href);
                window.location.href = 'login.html';
                return;
            }

            if (buyerEmail === globalProduct.sellerEmail) {
                alert('You cannot chat about your own product');
                return;
            }

            try {
                // Check for existing chat
                const existingChatQuery = JSON.stringify({
                    buyer: buyerEmail,
                    seller: globalProduct.sellerEmail,
                    productId: globalProduct._id
                });

                const existingChatResponse = await fetch(`https://evadatabase-f3b8.restdb.io/rest/chats?q=${existingChatQuery}`, {
                    headers: {
                        "Content-Type": "application/json",
                        "x-apikey": APIKEY
                    }
                });

                const existingChats = await existingChatResponse.json();

                let chatId;
                if (existingChats.length === 0) {
                    // Create new chat
                    const newChat = {
                        buyer: buyerEmail,
                        seller: globalProduct.sellerEmail,
                        productId: globalProduct._id,
                        productName: globalProduct.itemName,
                        lastMessageTime: new Date().toISOString(),
                        messages: [] // Add this
                    };

                    const createChatResponse = await fetch(`https://evadatabase-f3b8.restdb.io/rest/chats`, {
                        method: 'POST',
                        headers: {
                            "Content-Type": "application/json",
                            "x-apikey": APIKEY
                        },
                        body: JSON.stringify(newChat)
                    });

                    const createdChat = await createChatResponse.json();
                    chatId = createdChat._id;
                } else {
                    chatId = existingChats[0]._id;
                }

                // Redirect to chat page
                window.location.href = `chat.html?chatId=${chatId}`;
            } catch (error) {
                console.error('Error starting chat:', error);
                alert('Failed to start chat. Please try again.');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            getProductDetails();

            const messageSellerBtn = document.getElementById('messageSellerBtn');
            if (messageSellerBtn) {
                messageSellerBtn.addEventListener('click', startChatWithSeller);
            }
        });
    </script> -->
    <style>
        .product-details-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .product-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .product-image-large img {
            width: 100%;
            height: auto;
            border-radius: 8px;
        }

        .product-info {
            padding: 1rem;
        }

        .price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2563eb;
            margin: 1rem 0;
        }

        .specs {
            margin: 1.5rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
        }

        @media (max-width: 768px) {
            .product-details-grid {
                grid-template-columns: 1fr;
            }
        }

        .message-seller-btn {
         position: fixed;
         bottom: 20px;
         right: 20px;
         background-color: var(--accent-color, #A19AD3);
         color: white;
         border: none;
         border-radius: 50%;
         width: 60px;
         height: 60px;
         cursor: pointer;
         box-shadow: 0 2px 10px rgba(0,0,0,0.2);
         display: flex;
         align-items: center;
         justify-content: center;
         transition: transform 0.2s, background-color 0.2s;
         z-index: 1000;
     }

     .message-seller-btn:hover {
         transform: scale(1.1);
         background-color: var(--text-color, #2E2B41);
     }

     .message-seller-btn i {
         font-size: 24px;
     }

     .cart-toggle {
         position: fixed;
         bottom: 90px;
         right: 20px;
         background-color: var(--accent-color, #A19AD3);
         color: white;
         border: none;
         border-radius: 50%;
         width: 60px;
         height: 60px;
         cursor: pointer;
         box-shadow: 0 2px 10px rgba(0,0,0,0.2);
         display: flex;
         align-items: center;
         justify-content: center;
         transition: transform 0.2s;
         z-index: 1000;
     }

     .cart-toggle:hover {
         transform: scale(1.1);
         background-color: var(--text-color, #2E2B41);
     }

     .cart-count {
         position: absolute;
         top: -5px;
         right: -5px;
         background-color: #ff4444;
         color: white;
         border-radius: 50%;
         width: 20px;
         height: 20px;
         font-size: 12px;
         display: flex;
         align-items: center;
         justify-content: center;
     }
    </style>
</body>
<script src="js_folder/productinformation.js"></script>

</html>